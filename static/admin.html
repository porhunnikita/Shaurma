
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞: –ú–µ–Ω—é –®–∞—É—Ä–º—ã</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { padding: 20px; background: #f7f7f7; }
        .menu-item { border-radius: 10px; background: white; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .menu-item .btn-danger { float: right; }
        .menu-item p { margin: 0; }
        #msg { margin-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h2 class="text-center mb-4">–ê–¥–º–∏–Ω–∫–∞: –ú–µ–Ω—é –®–∞—É—Ä–º—ã</h2>

    <div class="card p-4 mb-4">
        <h5>–î–æ–±–∞–≤–∏—Ç—å / –ò–∑–º–µ–Ω–∏—Ç—å –±–ª—é–¥–æ</h5>
        <input id="title" class="form-control my-1" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
        <input id="price" type="number" class="form-control my-1" placeholder="–¶–µ–Ω–∞">
        <textarea id="desc" class="form-control my-1" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
        <input id="upload" type="file" class="form-control my-1">
        <select id="category" class="form-control my-2">
            <option value="chicken">–ö—É—Ä–∏—Ü–∞</option>
            <option value="snacks">–ó–∞–∫—É—Å–∫–∏</option>
            <option value="corndog">–ö–æ—Ä–Ω –î–æ–≥–∏</option>
        </select>
        <button class="btn btn-primary" onclick="addItem()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="btn btn-success" onclick="saveMenu()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä</button>
        <div id="msg" class="text-success fw-bold"></div>
    </div>

    <h5 class="mb-3">–¢–µ–∫—É—â–µ–µ –º–µ–Ω—é</h5>
    <div id="menu"></div>
</div>

<script>
    let menu = [];

    function showMsg(text, color="success") {
        const msg = document.getElementById("msg");
        msg.className = "text-" + color + " fw-bold";
        msg.textContent = text;
        setTimeout(() => msg.textContent = "", 3000);
    }

    function render() {
        const out = document.getElementById("menu");
        out.innerHTML = "";
        menu.forEach((item, index) => {
            out.innerHTML += `
                <div class="menu-item">
                    <b>${item.title}</b> ‚Äî ${item.price}‚ÇΩ
                    <button class="btn btn-sm btn-danger" onclick='deleteItem(${index})'>–£–¥–∞–ª–∏—Ç—å</button>
                    <br><small>${item.desc}</small><br>
                    <small class="text-muted">${item.image} ‚Äî <i>${item.category}</i></small>
                </div>
            `;
        });
    }

    function addItem() {
        const title = document.getElementById("title").value.trim();
        const price = document.getElementById("price").value.trim();
        const desc = document.getElementById("desc").value.trim();
        const cat = document.getElementById("category").value;
        const fileInput = document.getElementById("upload");

        if (!title || !price || !desc || fileInput.files.length === 0)
            return showMsg("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", "danger");

        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append("file", file);
        fetch("/upload", { method: "POST", body: formData })
            .then(res => res.json())
            .then(data => {
                const image = data.path;
                const existing = menu.find(i => i.title === title && i.category === cat);
                if (existing) {
                    Object.assign(existing, { price, desc, image });
                } else {
                    menu.push({ title, price, desc, image, category: cat });
                }
                showMsg("–ë–ª—é–¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ");
                render();
                fileInput.value = "";
            });
    }

    function deleteItem(index) {
        fetch("/menu/delete", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ index })
        }).then(() => {
            menu.splice(index, 1);
            render();
            showMsg("–ë–ª—é–¥–æ —É–¥–∞–ª–µ–Ω–æ", "danger");
        });
    }

    function saveMenu() {
        fetch("/menu", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(menu)
        }).then(() => showMsg("–ú–µ–Ω—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ"));
    }

    fetch("/menu")
        .then(res => res.json())
        .then(data => { menu = data; render(); });
</script>
</body>
</html>
